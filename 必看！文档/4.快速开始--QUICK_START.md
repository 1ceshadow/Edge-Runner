# Edge-Runner æ¶æ„é‡æ„ - å¿«é€Ÿå…¥é—¨æŒ‡å—

## ğŸš€ 5 åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### 1. åˆ›å»º GameConfig ScriptableObject

```
å³é”®ç‚¹å‡» Assets/Resources/Config/ æ–‡ä»¶å¤¹
â†’ Create > Edge-Runner > Game Config
â†’ å‘½åä¸º "GameConfig"
```

### 2. åœ¨åœºæ™¯ä¸­è®¾ç½®ç®¡ç†å™¨

**åœ¨ä½ çš„æ¸¸æˆåœºæ™¯ä¸­:**

1. åˆ›å»ºä¸€ä¸ªç©º GameObjectï¼Œåä¸º `GameFramework`
2. æ·»åŠ ä»¥ä¸‹è„šæœ¬:
   - `BulletPool.cs` - ç®¡ç†å­å¼¹
   - `EnemyPool.cs` - ç®¡ç†æ•Œäºº

**åœ¨ç©å®¶ GameObject ä¸­:**

1. æ·»åŠ ä»¥ä¸‹ç»„ä»¶ (æŒ‰é¡ºåº):
   - `PlayerRoot.cs`
   - `PlayerMovementController.cs`
   - `PlayerEnergySystem.cs`
   - `PlayerHealthSystem.cs`
   - `PlayerStateMachine.cs`
   - `PlayerCombatSystem.cs`
   - `PlayerInputHandler.cs`
   - `Rigidbody2D` (Dynamic, Gravity Scale = 0)
   - `CircleCollider2D` (Tag = "Player")

2. åœ¨ Inspector ä¸­ä¸º PlayerRoot åˆ†é…æ‰€æœ‰å­ç³»ç»Ÿçš„å¼•ç”¨

### 3. æ›´æ–°æ•Œäºº Prefab

1. æ‰“å¼€æ•Œäºº Prefab
2. æ›¿æ¢æ‰€æœ‰ `EnemyController.cs` ä¸º `ShooterEnemy.cs`
3. ç¡®ä¿æ•Œäººæœ‰ `Rigidbody2D` å’Œ `CircleCollider2D`

### 4. æ›´æ–° UI ç³»ç»Ÿ

**EnergyBar.cs (æ”¹è¿›ç‰ˆ):**

```csharp
public class EnergyBar : MonoBehaviour
{
    [SerializeField] private Image fillImage;
    
    private void OnEnable()
    {
        // è®¢é˜…äº‹ä»¶è€Œéç›´æ¥è®¿é—® PlayerMovement!
        EventBus.Subscribe<PlayerEnergyChangedEvent>(OnEnergyChanged);
    }
    
    private void OnDisable()
    {
        EventBus.Unsubscribe<PlayerEnergyChangedEvent>(OnEnergyChanged);
    }
    
    private void OnEnergyChanged(PlayerEnergyChangedEvent evt)
    {
        fillImage.fillAmount = evt.Percentage;
    }
}
```

---

## âœ… è¿ç§»æ£€æŸ¥æ¸…å•

### Phase 1: æ¡†æ¶æ­å»º
- [ ] åˆ›å»º `Assets/Scripts/Framework/` ç›®å½•ç»“æ„
- [ ] å®ç° ServiceLocator (`ServiceLocator.cs`)
- [ ] å®ç° EventBus (`EventBus.cs`)
- [ ] åˆ›å»º GameConfig ScriptableObject (`GameConfig.cs`)
- [ ] åˆ›å»ºå¯¹è±¡æ± åŸºç±» (`GenericPool.cs`)
- [ ] åˆ›å»ºæ‰€æœ‰å¿…è¦çš„æ¥å£ (`Interfaces.cs`)

### Phase 2: ç©å®¶ç³»ç»Ÿé‡æ„
- [ ] åˆ›å»º PlayerRoot (`PlayerRoot.cs`)
- [ ] åˆ›å»º PlayerMovementController (`PlayerMovementController.cs`)
- [ ] åˆ›å»º PlayerEnergySystem (`PlayerEnergySystem.cs`)
- [ ] åˆ›å»º PlayerHealthSystem (`PlayerHealthSystem.cs`)
- [ ] åˆ›å»º PlayerCombatSystem (`PlayerCombatSystem.cs`)
- [ ] åˆ›å»º PlayerInputHandler (`PlayerInputHandler.cs`)
- [ ] åˆ›å»º PlayerStateMachine (`PlayerStateMachine.cs`)
- [ ] æµ‹è¯•: ç©å®¶èƒ½ç§»åŠ¨å’Œæ§åˆ¶å—?
- [ ] æµ‹è¯•: èƒ½é‡ç³»ç»Ÿå·¥ä½œå—?
- [ ] æµ‹è¯•: å†²åˆºå’Œæ—¶ç¼“å·¥ä½œå—?

### Phase 3: æ•Œäººç³»ç»Ÿé‡æ„
- [ ] åˆ›å»º EnemyBase (`EnemyBase.cs`)
- [ ] åˆ›å»º ShooterEnemy (`ShooterEnemy.cs`)
- [ ] åˆ›å»º EnemyPool (`EnemyPool.cs`)
- [ ] è¿ç§»æ—§ EnemyController é€»è¾‘åˆ° ShooterEnemy
- [ ] æµ‹è¯•: æ•Œäººèƒ½å°„å‡»å—?
- [ ] æµ‹è¯•: å¯¹è±¡æ± å·¥ä½œå—?

### Phase 4: æŠ•å°„ç‰©ç³»ç»Ÿé‡æ„
- [ ] åˆ›å»º Bullet (`Bullet.cs`)
- [ ] åˆ›å»º BulletPool (`BulletPool.cs`)
- [ ] è¿ç§»æ—§ BulletController é€»è¾‘åˆ° Bullet
- [ ] æµ‹è¯•: å­å¼¹èƒ½å‡»ä¸­ç©å®¶å—?
- [ ] æ€§èƒ½æµ‹è¯•: GC Alloc å‡å°‘äº†å—?

### Phase 5: UI ç³»ç»Ÿæ›´æ–°
- [ ] æ›´æ–° EnergyBar ä½¿ç”¨äº‹ä»¶ç³»ç»Ÿ
- [ ] æ›´æ–° HealthBar ä½¿ç”¨äº‹ä»¶ç³»ç»Ÿ
- [ ] æ›´æ–° PauseMenu ä½¿ç”¨ GameStateManager
- [ ] æ›´æ–° WinTrigger å‘é€æ­£ç¡®çš„äº‹ä»¶
- [ ] æµ‹è¯•: UI å“åº”æ­£ç¡®å—?

### Phase 6: é›†æˆæµ‹è¯•
- [ ] å®Œæ•´æ¸¸æˆæµç¨‹æµ‹è¯•
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] å†…å­˜åˆ†æ
- [ ] ä»£ç å®¡æŸ¥
- [ ] æ–‡æ¡£æ›´æ–°

---

## ğŸ”§ å¸¸è§é—®é¢˜è§£ç­”

### Q: æˆ‘æ˜¯å¦éœ€è¦ç«‹å³é‡æ„æ‰€æœ‰ä»£ç ?

**A:** ä¸éœ€è¦ã€‚å»ºè®®çš„æ–¹å¼æ˜¯:
1. **ç¬¬ä¸€å‘¨**: å»ºç«‹æ¡†æ¶ (ServiceLocator, EventBus, Config)
2. **ç¬¬äºŒå‘¨**: é‡æ„ç©å®¶ç³»ç»Ÿ
3. **ç¬¬ä¸‰å‘¨**: é‡æ„æ•Œäººå’Œå­å¼¹
4. **ç¬¬å››å‘¨**: æ•´åˆå’Œæµ‹è¯•

### Q: æ—§ä»£ç å’Œæ–°ä»£ç èƒ½å…±å­˜å—?

**A:** å¯ä»¥ï¼Œä½†ä¸æ¨èã€‚æ—§çš„ `PlayerMovement.cs` åº”è¯¥è¢«é€æ­¥æ›¿æ¢ä¸ºæ–°ç³»ç»Ÿã€‚

### Q: å¦‚ä½•æµ‹è¯•æ–°æ¶æ„?

**A:** ä½¿ç”¨ Unity Test Framework:
```csharp
[Test]
public void PlayerMovement_ShouldMoveInCorrectDirection()
{
    var player = new PlayerRoot();
    player.GetComponent<PlayerMovementController>().SetMoveInput(Vector2.right);
    Assert.AreEqual(Vector2.right, player.GetComponent<IMoveable>().GetDirection());
}
```

### Q: æ€§èƒ½ä¼šæ”¹å–„å—?

**A:** æ˜¯çš„ã€‚å…³é”®æ”¹è¿›:
- **å¯¹è±¡æ± **: å‡å°‘ GC Alloc 80%
- **äº‹ä»¶ç³»ç»Ÿ**: é›¶çƒ­åˆ†é… (zero-allocation events)
- **é…ç½®ç³»ç»Ÿ**: æ¶ˆé™¤ç¡¬ç¼–ç çš„åˆ†é…

---

## ğŸ“š ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹ 1: ä»æ—§ç³»ç»Ÿå‡çº§ EnergyBar

**æ—§ç‰ˆæœ¬ (ç´§è€¦åˆ)**:
```csharp
public class EnergyBar : MonoBehaviour
{
    private PlayerMovement player;
    
    void Start()
    {
        player = GameObject.FindGameObjectWithTag("Player")
                          .GetComponent<PlayerMovement>();  // âŒ ç¡¬ç¼–ç 
    }
    
    void Update()
    {
        image.fillAmount = player.currentEnergy / player.maxEnergy;  // âŒ ç›´æ¥è®¿é—®
    }
}
```

**æ–°ç‰ˆæœ¬ (äº‹ä»¶é©±åŠ¨)**:
```csharp
public class EnergyBar : MonoBehaviour
{
    [SerializeField] private Image fillImage;
    
    private void OnEnable()
    {
        EventBus.Subscribe<PlayerEnergyChangedEvent>(OnEnergyChanged);  // âœ… äº‹ä»¶è®¢é˜…
    }
    
    private void OnDisable()
    {
        EventBus.Unsubscribe<PlayerEnergyChangedEvent>(OnEnergyChanged);
    }
    
    private void OnEnergyChanged(PlayerEnergyChangedEvent evt)
    {
        fillImage.fillAmount = evt.Percentage;  // âœ… é€šè¿‡äº‹ä»¶æ•°æ®
    }
}
```

### ç¤ºä¾‹ 2: ä»æ—§æ•Œäººç³»ç»Ÿå‡çº§

**æ—§ç‰ˆæœ¬**:
```csharp
public class EnemyController : MonoBehaviour
{
    private void Start()
    {
        player = GameObject.FindGameObjectWithTag("Player").transform;  // âŒ
        playerMovement = player.GetComponent<PlayerMovement>();  // âŒ
    }
}
```

**æ–°ç‰ˆæœ¬**:
```csharp
public class ShooterEnemy : EnemyBase
{
    protected override void Start()
    {
        base.Start();
        // playerService å·²ç”±åŸºç±»é€šè¿‡ ServiceLocator åˆå§‹åŒ– âœ…
        playerService = ServiceLocator.Get<IPlayerService>();
    }
}
```

### ç¤ºä¾‹ 3: è®¢é˜…æ¸¸æˆäº‹ä»¶

```csharp
public class GameManager : MonoBehaviour
{
    private void OnEnable()
    {
        EventBus.Subscribe<EnemyDefeatedEvent>(OnEnemyDefeated);
        EventBus.Subscribe<PlayerDiedEvent>(OnPlayerDied);
        EventBus.Subscribe<LevelCompleteEvent>(OnLevelComplete);
    }
    
    private void OnDisable()
    {
        EventBus.Unsubscribe<EnemyDefeatedEvent>(OnEnemyDefeated);
        EventBus.Unsubscribe<PlayerDiedEvent>(OnPlayerDied);
        EventBus.Unsubscribe<LevelCompleteEvent>(OnLevelComplete);
    }
    
    private void OnEnemyDefeated(EnemyDefeatedEvent evt)
    {
        Debug.Log($"Enemy defeated! Reward: {evt.RewardGiven}");
        // æ›´æ–° UIã€æ’­æ”¾å£°éŸ³ç­‰
    }
}
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç°åœ¨**: é˜…è¯» `REFACTORING_GUIDE.md` ä¸­çš„å®Œæ•´æ¶æ„æ–‡æ¡£
2. **ä»Šå¤©**: åˆ›å»º Framework ç›®å½•å’ŒåŸºç¡€æ–‡ä»¶
3. **æœ¬å‘¨**: æ­å»º ServiceLocator å’Œ EventBusï¼Œåˆ›å»º GameConfig
4. **ä¸‹å‘¨**: å¼€å§‹ç©å®¶ç³»ç»Ÿé‡æ„

---

## ğŸ“ è·å¾—å¸®åŠ©

- æŸ¥çœ‹ `Assets/Scripts/Framework/` ä¸­çš„ä»£ç ç¤ºä¾‹
- å‚è€ƒ `Assets/Scripts/Player/` ä¸­çš„æ–°ç»„ä»¶
- æ£€æŸ¥ `Assets/Scripts/Enemies/` ä¸­çš„æ–°æ•Œäººç³»ç»Ÿ
- é˜…è¯»ä»£ç ä¸­çš„è¯¦ç»†æ³¨é‡Š

---

**æœ€åæ›´æ–°**: 2025-11-25
**ç‰ˆæœ¬**: 1.0
