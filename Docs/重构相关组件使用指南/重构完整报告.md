# Edge-Runner é‡æ„å®Œæ•´æŠ¥å‘Š

## ğŸ“Š æ€»ç»“

### é‡æ„ç›®æ ‡
å°†åŸæœ¬ **"åˆè‡­åˆé•¿"** çš„ç©å®¶ç§»åŠ¨ä»£ç ï¼ˆ~1200è¡Œåˆ†æ•£åœ¨5+æ–‡ä»¶ï¼‰é‡æ„ä¸ºç¬¦åˆ **SOLID åŸåˆ™** çš„æ¸…æ™°æ¶æ„ï¼ŒåŒæ—¶è§£å†³ **å†²åˆºç©¿å¢™** é—®é¢˜ã€‚

### æ ¸å¿ƒæˆæœ

| æŒ‡æ ‡ | é‡æ„å‰ | é‡æ„å |
|------|--------|--------|
| ç©å®¶ç›¸å…³è„šæœ¬ | 5+ æ–‡ä»¶ï¼Œé«˜åº¦è€¦åˆ | 10+ æ–‡ä»¶ï¼ŒèŒè´£å•ä¸€ |
| ç§»åŠ¨ä»£ç è¡Œæ•° | ~620 è¡Œ (PlayerMovement) | ~400 è¡Œ (ç²¾ç®€) |
| å†²åˆºç©¿å¢™ | âŒ å­˜åœ¨ | âœ… å·²ä¿®å¤ |
| é…ç½®ç®¡ç† | åˆ†æ•£åœ¨å„è„šæœ¬ Inspector | é›†ä¸­åˆ° GameConfig SO |
| ç³»ç»Ÿé€šä¿¡ | ç›´æ¥å¼•ç”¨ | EventBus äº‹ä»¶é©±åŠ¨ |
| å¯¹è±¡åˆ›å»º | Instantiate/Destroy | å¯¹è±¡æ± å¤ç”¨ |

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ProjectLifetimeScope                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ GameState   â”‚  â”‚ Audio       â”‚  â”‚ ConfigManager           â”‚  â”‚
â”‚  â”‚ Manager     â”‚  â”‚ Manager     â”‚  â”‚ (GameConfig SO)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PoolManager â”‚  â”‚ BulletSvc   â”‚  â”‚ EventBus                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GameLifetimeScope (æ¯å…³å¡)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    PlayerController                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ StateMachine â”‚ â”‚ SkillManager â”‚ â”‚ PlayerMovement   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ (Idle/Move)  â”‚ â”‚ (æ—¶ç¼“æŠ€èƒ½)   â”‚ â”‚ (ç§»åŠ¨+å†²åˆº+å¢™æ£€æµ‹)â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ InputHandler â”‚ â”‚ EnergySystem â”‚ â”‚ HealthSystem     â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚    â”‚
â”‚  â”‚  â”‚ CombatSystem â”‚                                       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Camera      â”‚  â”‚ Enemy       â”‚  â”‚ WinTrigger            â”‚    â”‚
â”‚  â”‚ Controller  â”‚  â”‚ Controller[]â”‚  â”‚                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ ç›®å½•ç»“æ„

```
Assets/
â”œâ”€â”€ Core/Scripts/
â”‚   â”œâ”€â”€ Framework/
â”‚   â”‚   â”œâ”€â”€ GameLifetimeScope.cs      # åœºæ™¯çº§ DI å®¹å™¨
â”‚   â”‚   â”œâ”€â”€ ProjectLifetimeScope.cs   # å…¨å±€ DI å®¹å™¨
â”‚   â”‚   â”œâ”€â”€ IPlayerService.cs         # ç©å®¶æœåŠ¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ IGameStateManager.cs      # æ¸¸æˆçŠ¶æ€æ¥å£
â”‚   â”‚   â”œâ”€â”€ IAudioManager.cs          # éŸ³é¢‘æ¥å£
â”‚   â”‚   â”œâ”€â”€ ServiceHelper.cs          # æœåŠ¡æŸ¥æ‰¾è¾…åŠ©
â”‚   â”‚   â”œâ”€â”€ Events/
â”‚   â”‚   â”‚   â”œâ”€â”€ EventBus.cs           # äº‹ä»¶æ€»çº¿
â”‚   â”‚   â”‚   â””â”€â”€ GameEvents.cs         # æ‰€æœ‰äº‹ä»¶å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ Config/
â”‚   â”‚   â”‚   â”œâ”€â”€ GameConfig.cs         # é…ç½® ScriptableObject
â”‚   â”‚   â”‚   â””â”€â”€ ConfigManager.cs      # é…ç½®ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ Pooling/
â”‚   â”‚       â”œâ”€â”€ IPoolable.cs          # æ± åŒ–æ¥å£
â”‚   â”‚       â”œâ”€â”€ GenericPool.cs        # æ³›å‹å¯¹è±¡æ± 
â”‚   â”‚       â””â”€â”€ PoolManager.cs        # æ± ç®¡ç†å™¨
â”‚   â”œâ”€â”€ Manager/
â”‚   â”‚   â”œâ”€â”€ GameStateManager.cs       # æ¸¸æˆçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ AudioManager.cs           # éŸ³é¢‘ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ CameraController.cs       # ç›¸æœºæ§åˆ¶
â”‚   â”‚   â””â”€â”€ BulletService.cs          # å­å¼¹å‘å°„æœåŠ¡
â”‚   â””â”€â”€ Input/
â”‚       â””â”€â”€ PlayerInputActions.cs     # è¾“å…¥å®šä¹‰
â”‚
â”œâ”€â”€ Modules/
â”‚   â”œâ”€â”€ Player/Scripts/
â”‚   â”‚   â”œâ”€â”€ Player.cs                 # IPlayerService å®ç°
â”‚   â”‚   â”œâ”€â”€ PlayerDeathHandler.cs     # æ­»äº¡å¤„ç†
â”‚   â”‚   â”œâ”€â”€ States/
â”‚   â”‚   â”‚   â”œâ”€â”€ PlayerController.cs   # ç©å®¶ä¸»æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ PlayerStateMachine.cs # çŠ¶æ€æœº
â”‚   â”‚   â”‚   â”œâ”€â”€ IPlayerState.cs       # çŠ¶æ€æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ IPlayerContext.cs     # çŠ¶æ€ä¸Šä¸‹æ–‡æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ PlayerStateBase.cs    # çŠ¶æ€åŸºç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ IdleState.cs          # å¾…æœºçŠ¶æ€
â”‚   â”‚   â”‚   â””â”€â”€ MovingState.cs        # ç§»åŠ¨çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ Systems/
â”‚   â”‚   â”‚   â”œâ”€â”€ PlayerMovement.cs     # ç§»åŠ¨+å†²åˆº+å¢™æ£€æµ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ PlayerInputHandler.cs # è¾“å…¥å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ PlayerEnergySystem.cs # èƒ½é‡ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ PlayerHealthSystem.cs # ç”Ÿå‘½ç³»ç»Ÿ
â”‚   â”‚   â”‚   â””â”€â”€ PlayerCombatSystem.cs # æˆ˜æ–—ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ Skills/
â”‚   â”‚       â””â”€â”€ PlayerSkillManager.cs # æŠ€èƒ½ç®¡ç†(æ—¶ç¼“)
â”‚   â”‚
â”‚   â”œâ”€â”€ Enemies/Scripts/
â”‚   â”‚   â””â”€â”€ EnemyController.cs        # æ•Œäººæ§åˆ¶å™¨
â”‚   â”‚
â”‚   â””â”€â”€ Bullet/Scripts/
â”‚       â”œâ”€â”€ BulletManager.cs          # å­å¼¹è¿½è¸ª(å®Œç¾é—ªé¿)
â”‚       â””â”€â”€ PoolableBullet.cs         # æ± åŒ–å­å¼¹
```

---

## ğŸ“œ å„ç³»ç»Ÿ/è„šæœ¬è¯¦è§£

### 1. æ ¸å¿ƒæ¡†æ¶ (Core/Scripts/Framework)

#### 1.1 ProjectLifetimeScope.cs
**èŒè´£**ï¼šå…¨å±€ DI å®¹å™¨ï¼Œç®¡ç†è·¨åœºæ™¯æŒä¹…çš„æœåŠ¡

```csharp
// æ³¨å†Œå†…å®¹
- IGameStateManager â†’ GameStateManager
- IAudioManager â†’ AudioManager  
- IBulletService â†’ BulletService
- IPoolManager â†’ PoolManager
- ConfigManager (å•ä¾‹)
```

**ç”Ÿå‘½å‘¨æœŸ**ï¼šDontDestroyOnLoadï¼Œæ¸¸æˆå¯åŠ¨æ—¶åˆ›å»ºä¸€æ¬¡

---

#### 1.2 GameLifetimeScope.cs
**èŒè´£**ï¼šåœºæ™¯çº§ DI å®¹å™¨ï¼Œç®¡ç†å½“å‰å…³å¡çš„æœåŠ¡

```csharp
// è‡ªåŠ¨å‘ç°å¹¶æ³¨å…¥
- Player â†’ æ³¨å†Œä¸º IPlayerService
- CameraController â†’ æ³¨å…¥ IPlayerService
- EnemyController[] â†’ æ³¨å…¥ IPlayerService
- WinTrigger â†’ æ³¨å…¥ IGameStateManager
```

**ç”Ÿå‘½å‘¨æœŸ**ï¼šæ¯ä¸ªå…³å¡åœºæ™¯ä¸€ä¸ªï¼Œåœºæ™¯å¸è½½æ—¶é”€æ¯

---

#### 1.3 EventBus.cs
**èŒè´£**ï¼šå‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„äº‹ä»¶æ€»çº¿ï¼Œè§£è€¦ç³»ç»Ÿé€šä¿¡

```csharp
// ä½¿ç”¨ç¤ºä¾‹
EventBus.Subscribe<EnemyDefeatedEvent>(OnEnemyDefeated);
EventBus.Publish(new EnemyDefeatedEvent { ... });
EventBus.Unsubscribe<EnemyDefeatedEvent>(OnEnemyDefeated);
```

**å·²å®šä¹‰äº‹ä»¶**ï¼š
| äº‹ä»¶ | ç”¨é€” |
|------|------|
| `PlayerEnergyChangedEvent` | èƒ½é‡å˜åŒ–ï¼ŒUI æ›´æ–° |
| `PlayerDashedEvent` | å†²åˆºå®Œæˆï¼ŒéŸ³æ•ˆ/ç‰¹æ•ˆ |
| `EnemyDefeatedEvent` | æ•Œäººæ­»äº¡ï¼Œå¥–åŠ±èƒ½é‡ |
| `TimeSlowStateChangedEvent` | æ—¶ç¼“çŠ¶æ€åˆ‡æ¢ |
| `BulletFiredEvent` | å­å¼¹å‘å°„ |
| `BulletHitEvent` | å­å¼¹å‘½ä¸­ |

---

#### 1.4 ConfigManager.cs + GameConfig.cs
**èŒè´£**ï¼šé›†ä¸­ç®¡ç†æ‰€æœ‰æ¸¸æˆå‚æ•°

```csharp
// GameConfig (ScriptableObject) ç»“æ„
GameConfig
â”œâ”€â”€ PlayerConfig
â”‚   â”œâ”€â”€ MoveSpeed: 6.2
â”‚   â”œâ”€â”€ DashDistance: 3.9
â”‚   â”œâ”€â”€ DashCooldown: 0.2
â”‚   â”œâ”€â”€ MaxEnergy: 80
â”‚   â””â”€â”€ ...
â”œâ”€â”€ EnemyConfig
â”œâ”€â”€ BulletConfig
â””â”€â”€ PoolConfig
```

**ä½¿ç”¨æ–¹å¼**ï¼š
```csharp
float speed = ConfigManager.Player.MoveSpeed;
float dashDist = ConfigManager.GetDashDistance();
```

---

#### 1.5 GenericPool.cs + PoolManager.cs
**èŒè´£**ï¼šæ³›å‹å¯¹è±¡æ± ï¼Œé¿å…é¢‘ç¹ Instantiate/Destroy

```csharp
// è·å–å¯¹è±¡
PoolableBullet bullet = PoolManager.Instance.GetBullet(pos, rot);

// è¿”å›å¯¹è±¡ï¼ˆæ›¿ä»£ Destroyï¼‰
bullet.ReturnToPool();
```

**æ± åŒ–å¯¹è±¡å¿…é¡»å®ç°**ï¼š
```csharp
public interface IPoolable {
    void OnSpawn();      // ä»æ± å–å‡ºæ—¶
    void OnDespawn();    // è¿”å›æ± æ—¶
    void ReturnToPool(); // ä¸»åŠ¨è¿”å›
}
```

---

### 2. ç©å®¶ç³»ç»Ÿ (Modules/Player)

#### 2.1 PlayerController.cs
**èŒè´£**ï¼šç©å®¶çš„ä¸­å¤®åè°ƒå™¨ï¼Œè¿æ¥æ‰€æœ‰å­ç³»ç»Ÿ

```csharp
public class PlayerController : MonoBehaviour, IPlayerContext
{
    // å­ç³»ç»Ÿå¼•ç”¨
    public PlayerStateMachine StateMachine;
    public PlayerSkillManager SkillManager;
    public PlayerMovement Movement;
    public PlayerEnergySystem Energy;
    public PlayerHealthSystem Health;
    public PlayerCombatSystem Combat;
    public PlayerInputHandler InputHandler;
    
    // é…ç½®è®¿é—®ï¼ˆå…¨éƒ¨ä» ConfigManager è¯»å–ï¼‰
    public float MoveSpeed => ConfigManager.GetMoveSpeed();
    public float DashDistance => ConfigManager.GetDashDistance();
    // ...
}
```

**ä¸åšä»€ä¹ˆ**ï¼šä¸ç›´æ¥å¤„ç†è¾“å…¥ã€ç§»åŠ¨ã€å†²åˆºé€»è¾‘ï¼ˆå§”æ‰˜ç»™å­ç³»ç»Ÿï¼‰

---

#### 2.2 PlayerMovement.cs â­ (æ ¸å¿ƒé‡æ„)
**èŒè´£**ï¼šç»Ÿä¸€å¤„ç†ç§»åŠ¨ã€å†²åˆºã€å¢™ä½“æ£€æµ‹

**æ ¸å¿ƒç‰¹æ€§**ï¼š

| ç‰¹æ€§ | å®ç° |
|------|------|
| æ™®é€šç§»åŠ¨ | `CircleCast` å‰å‘ç¢°æ’æ£€æµ‹ |
| å†²åˆº | çº¯ `CircleCast` è®¡ç®—å®‰å…¨ä½ç½® |
| å¹¿å‘Šç‰Œå¸é™„ | åªæ£€æµ‹ `Billboard` å±‚ |
| å¢™ä½“ç¢°æ’ | åªæ£€æµ‹ `Wall` å±‚ |
| ç¬ç§»æ‰§è¡Œ | `pendingDashPosition` + `FixedUpdate` |

**å…³é”®æ–¹æ³•**ï¼š
```csharp
// æ›´æ–°å¹¿å‘Šç‰Œæ¥è§¦çŠ¶æ€ï¼ˆå¸é™„ç”¨ï¼‰
public void UpdateWallContacts();

// è¿‡æ»¤è¾“å…¥å®ç°å¸é™„
public Vector2 GetFilteredInput(Vector2 rawInput);

// å®‰å…¨ç§»åŠ¨
public void Move(Vector2 input, float speed, float deltaTime);

// å°è¯•å†²åˆº
public bool TryDash(Vector2 direction, float distance, float cooldown, bool isPerfect);
```

**å†²åˆºå®‰å…¨ç®—æ³•**ï¼š
```csharp
private Vector2 GetSafeDashPosition(Vector2 start, Vector2 target)
{
    // ä½¿ç”¨ CircleCast æ¨¡æ‹Ÿç©å®¶ç¢°æ’ä½“ç§»åŠ¨
    RaycastHit2D hit = Physics2D.CircleCast(
        start, playerRadius, direction, totalDistance, wallLayerMask
    );
    
    if (hit.collider == null) return target;
    
    // è®¡ç®—å®‰å…¨åœæ­¢ä½ç½®
    return start + direction * (hit.distance - collisionOffset);
}
```

**Layer åŒºåˆ†**ï¼š
| Layer | ç”¨é€” | æ£€æµ‹æ–¹æ³• |
|-------|------|---------|
| Wall | å†²åˆºç¢°æ’ | `GetSafeDashPosition` |
| Billboard | å¸é™„åŠŸèƒ½ | `UpdateWallContacts` |

---

#### 2.3 PlayerStateMachine.cs
**èŒè´£**ï¼šç®¡ç†ç©å®¶çŠ¶æ€çš„æ³¨å†Œã€è½¬æ¢ã€æ›´æ–°

```csharp
// çŠ¶æ€æ³¨å†Œ
RegisterState(new IdleState(this, context));
RegisterState(new MovingState(this, context));

// çŠ¶æ€è½¬æ¢
TransitionTo<MovingState>();

// è‡ªåŠ¨è°ƒç”¨
Update()  â†’ currentState.OnUpdate()
FixedUpdate() â†’ currentState.OnFixedUpdate()
```

**å½“å‰çŠ¶æ€**ï¼š
- `IdleState` - å¾…æœºï¼Œæ— è¾“å…¥æ—¶
- `MovingState` - ç§»åŠ¨ï¼Œæœ‰è¾“å…¥æ—¶

---

#### 2.4 PlayerInputHandler.cs
**èŒè´£**ï¼šå°è£…æ–°è¾“å…¥ç³»ç»Ÿï¼Œæä¾›äº‹ä»¶é©±åŠ¨æ¥å£

```csharp
public event Action<Vector2> MoveChanged;
public event Action DashPerformed;
public event Action TimeSlowPerformed;
public event Action AttackPerformed;
```

**ç‰¹ç‚¹**ï¼šåªé‡‡é›†è¾“å…¥ï¼Œä¸åŒ…å«ä»»ä½•æ¸¸æˆé€»è¾‘

---

#### 2.5 PlayerEnergySystem.cs
**èŒè´£**ï¼šç®¡ç†èƒ½é‡çš„æ¶ˆè€—ã€å›å¤ã€å¥–åŠ±

```csharp
public void Tick(bool consumeForTimeSlow);  // æ¯å¸§è°ƒç”¨
public void AddReward(float amount, EnergyChangeReason reason);
public bool TryConsume(float amount, EnergyChangeReason reason);
public bool CanUseTimeSlow(float minThreshold);
```

**äº‹ä»¶å‘å¸ƒ**ï¼šèƒ½é‡å˜åŒ–æ—¶å‘å¸ƒ `PlayerEnergyChangedEvent`

---

#### 2.6 PlayerHealthSystem.cs
**èŒè´£**ï¼šç®¡ç†ç”Ÿå‘½å€¼ã€å—ä¼¤ã€æ­»äº¡

```csharp
public void TakeDamage(int damage, DamageType type, Vector2 source);
public void RestoreFull();
```

**æ­»äº¡å¤„ç†**ï¼šç”Ÿå‘½å½’é›¶æ—¶è°ƒç”¨ `IGameStateManager.TriggerDeath()`

---

#### 2.7 PlayerCombatSystem.cs
**èŒè´£**ï¼šè¿‘æˆ˜æ”»å‡»çš„ç¢°æ’ä½“æ¿€æ´»ã€å‘½ä¸­æ£€æµ‹

```csharp
public void PerformAttack();
// å†…éƒ¨ï¼šå¯ç”¨æ”»å‡»ç¢°æ’ä½“ â†’ æ£€æµ‹æ•Œäºº â†’ é€ æˆä¼¤å®³ â†’ å‘å¸ƒäº‹ä»¶
```

---

#### 2.8 PlayerSkillManager.cs
**èŒè´£**ï¼šç®¡ç†å¯éšæ—¶å¼€å…³çš„æŠ€èƒ½ï¼ˆç›®å‰åªæœ‰æ—¶ç¼“ï¼‰

```csharp
public void ToggleTimeSlow();
public bool TryStartTimeSlow();
public void StopTimeSlow();
```

**æ—¶ç¼“æ•ˆæœ**ï¼š
- ä¿®æ”¹ `Time.timeScale`
- æ’­æ”¾è§†è§‰ç‰¹æ•ˆï¼ˆè“è‰²å åŠ ï¼‰
- æŒç»­æ¶ˆè€—èƒ½é‡

---

### 3. æ•Œäººç³»ç»Ÿ (Modules/Enemies)

#### 3.1 EnemyController.cs
**èŒè´£**ï¼šæ•Œäºº AIã€å°„å‡»ã€å—ä¼¤ã€æ­»äº¡

```csharp
[Inject]
public void Construct(IPlayerService playerService, IBulletService bulletService);

public void TakeDamage(int damage);
```

**å°„å‡»æ–¹å¼**ï¼šé€šè¿‡æ³¨å…¥çš„ `IBulletService` å‘å°„å­å¼¹ï¼Œä¸å†ç›´æ¥ Instantiate

---

### 4. å­å¼¹ç³»ç»Ÿ (Modules/Bullet)

#### 4.1 PoolableBullet.cs
**èŒè´£**ï¼šæ± åŒ–å­å¼¹ï¼Œæ”¯æŒå‹å†›åˆ¤å®š

```csharp
public void Launch(Vector3 pos, Vector2 dir, float speed, float maxDist, 
                   int damage, bool isPlayerBullet, string sourceId);

// IPoolable å®ç°
public void OnSpawn();
public void OnDespawn();
public void ReturnToPool();
```

**ç¢°æ’å¤„ç†**ï¼š
- å‘½ä¸­ `Player` â†’ è§¦å‘ç©å®¶æ­»äº¡ï¼ˆå¦‚æœä¸æ˜¯ç©å®¶å­å¼¹ï¼‰
- å‘½ä¸­ `Enemy` â†’ é€ æˆä¼¤å®³ï¼ˆå¦‚æœæ˜¯ç©å®¶å­å¼¹ï¼‰
- å‘½ä¸­ `Cover` â†’ æ¶ˆå¤±

---

#### 4.2 BulletManager.cs
**èŒè´£**ï¼šè¿½è¸ªæ´»è·ƒå­å¼¹ï¼Œç”¨äºå®Œç¾é—ªé¿æ£€æµ‹

```csharp
public void RegisterBullet(Transform bullet);
public void UnregisterBullet(Transform bullet);
public bool CheckBulletsInRange(Vector2 position, float range);
```

---

### 5. ç®¡ç†å™¨ (Core/Scripts/Manager)

#### 5.1 GameStateManager.cs
**èŒè´£**ï¼šæ¸¸æˆçŠ¶æ€æµç¨‹æ§åˆ¶

```csharp
public void TriggerDeath();   // æ­»äº¡ â†’ æ˜¾ç¤ºæ­»äº¡UI
public void TriggerWin();     // èƒœåˆ© â†’ åŠ è½½ä¸‹ä¸€å…³
public void PauseGame();
public void ResumeGame();
```

---

#### 5.2 AudioManager.cs
**èŒè´£**ï¼šBGM æ’­æ”¾æ§åˆ¶

```csharp
public void PlayBGM(AudioClip clip);
public void StopBGM();
public void SetVolume(float volume);
```

---

#### 5.3 CameraController.cs
**èŒè´£**ï¼šè·Ÿéšç©å®¶

```csharp
[Inject]
public void Construct(IPlayerService playerService);

// LateUpdate ä¸­è·Ÿéšç©å®¶ä½ç½®
```

---

#### 5.4 BulletService.cs
**èŒè´£**ï¼šç»Ÿä¸€çš„å­å¼¹å‘å°„å…¥å£

```csharp
public PoolableBullet SpawnBullet(in BulletSpawnRequest request);
public void ReturnBullet(PoolableBullet bullet);
```

**ä¼˜å…ˆä½¿ç”¨å¯¹è±¡æ± **ï¼Œæ± ä¸å¯ç”¨æ—¶å›é€€åˆ° Instantiate

---

## ğŸ”§ å…³é”®æŠ€æœ¯ç‚¹

### 1. å†²åˆºä¸ç©¿å¢™
```
é—®é¢˜ï¼šåŸæ¥ä½¿ç”¨ Raycastï¼Œç»†çº¿å¯èƒ½ä»å¢™è§’ç©¿è¿‡
è§£å†³ï¼šä½¿ç”¨ CircleCast æ¨¡æ‹Ÿç©å®¶åœ†å½¢ç¢°æ’ä½“çš„ç§»åŠ¨è·¯å¾„

    Aâ”â”â”â”â—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â–¶B
       (â—‹)åœ   â–ˆâ–ˆ             
               â–ˆâ–ˆå¢™è§’         
```

### 2. å¹¿å‘Šç‰Œå¸é™„ vs å¢™ä½“ç¢°æ’
```
Billboard å±‚ï¼šåªæœ‰å¸é™„æ•ˆæœï¼ˆè´´ç€ç§»åŠ¨ï¼‰
Wall å±‚ï¼šåªæœ‰ç¢°æ’é˜»æŒ¡ï¼ˆä¸èƒ½ç©¿è¿‡ï¼‰

æ£€æµ‹åˆ†å¼€ï¼š
- UpdateWallContacts() ç”¨ billboardLayerMask
- GetSafeDashPosition() ç”¨ wallLayerMask
```

### 3. äº‹ä»¶è§£è€¦
```
æ—§ï¼šæ•Œäººæ­»äº¡ â†’ ç›´æ¥è°ƒç”¨ player.AddEnergy()
æ–°ï¼šæ•Œäººæ­»äº¡ â†’ EventBus.Publish(EnemyDefeatedEvent)
            â†’ PlayerController è®¢é˜…å¹¶å¤„ç†
```

### 4. é…ç½®é›†ä¸­
```
æ—§ï¼šæ¯ä¸ªè„šæœ¬ [SerializeField] é…ç½®è‡ªå·±çš„å‚æ•°
æ–°ï¼šæ‰€æœ‰å‚æ•°åœ¨ GameConfig.asset ä¸­é…ç½®
    è„šæœ¬é€šè¿‡ ConfigManager.Player.XXX è¯»å–
```

---

## âœ… éªŒæ”¶æ¸…å•

- [x] å†²åˆºä¸å†ç©¿å¢™
- [x] å¹¿å‘Šç‰Œæœ‰å¸é™„ï¼Œå¢™ä½“æ²¡æœ‰
- [x] VContainer DI æ­£å¸¸å·¥ä½œ
- [x] äº‹ä»¶ç³»ç»Ÿæ­£å¸¸å‘å¸ƒ/è®¢é˜…
- [x] å¯¹è±¡æ± æ­£å¸¸å·¥ä½œ
- [x] é…ç½®ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆ
- [x] æ—  Missing Script æŠ¥é”™
- [x] Console æ˜¾ç¤ºåˆå§‹åŒ–æˆåŠŸæ—¥å¿—

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | å†…å®¹ |
|------|------|
| `EVENT_SYSTEM_GUIDE.md` | äº‹ä»¶ç³»ç»Ÿè¯¦ç»†ä½¿ç”¨ |
| `åœºæ™¯è®¾ç½®æŒ‡å—.md` | åœºæ™¯é…ç½®æ­¥éª¤ |
| `åœºæ™¯ä¸Prefabé…ç½®æŒ‡å—.md` | Prefab é…ç½®è§„èŒƒ |
| `Playerç³»ç»Ÿè¿ç§»è¯´æ˜.md` | ç©å®¶ç³»ç»Ÿè¿ç§» |
| `Bulletç³»ç»Ÿå‡çº§è¯´æ˜.md` | å­å¼¹ç³»ç»Ÿå‡çº§ |
| `VContainerä½¿ç”¨æŒ‡å—.cs` | DI ä»£ç ç¤ºä¾‹ |
