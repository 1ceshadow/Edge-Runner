# 剑攻击系统配置指南

## 📁 新增文件结构

```
Assets/Modules/Player/Scripts/Combat/
├── SwordHitbox.cs      ← 剑碰撞体控制器
├── ComboSystem.cs      ← 连击状态管理
└── SlashTrail.cs       ← 挥砍拖尾特效

Assets/Core/Scripts/Framework/Config/
├── ConfigDefaults.cs   ← 新增 Combat 默认值
├── GameConfig.cs       ← 新增 CombatConfig
└── ConfigManager.cs    ← 新增战斗配置访问器
```

---

## 🎮 架构设计

### 系统组成

```
PlayerCombatSystem (协调者)
├── ComboSystem (纯逻辑，管理连击状态)
├── SwordHitbox (MonoBehaviour，物理碰撞)
└── SlashTrail (MonoBehaviour，视觉特效)
```

### 连击设计

| 连击 | 名称 | 起始角度 | 结束角度 | 伤害倍率 | 速度倍率 |
|------|------|----------|----------|----------|----------|
| 1 | 右斩 | +75° | -75° | 1.0x | 1.0x |
| 2 | 左斩 | -60° | +60° | 1.2x | 1.1x |
| 3 | 横扫 | 0° | 180° | 1.5x | 0.8x |

- 连击窗口：0.5 秒内连续攻击可触发下一段
- 第3击（横扫）是终结技，范围最大、伤害最高但速度较慢

---

## 🔧 Unity 配置步骤

### 步骤 1：创建剑子对象

1. 选择 **Player** GameObject
2. 右键 → **Create Empty**，命名为 `Sword`
3. 将 `Sword` 作为 Player 的子对象
4. 设置 Position 为 `(0, 0, 0)`

### 步骤 2：添加 SwordHitbox 组件

在 `Sword` 对象上：

1. **Add Component** → `SwordHitbox`
2. **Add Component** → `Polygon Collider 2D`
   - ✅ 勾选 **Is Trigger**
3. **Add Component** → `Sprite Renderer`（可选，用于调试可视化）
   - Sprite: 创建一个白色细长剑形
   - Color: 白色，Alpha 约 0.5
   - Sorting Layer: 设为 Player 之上

### 步骤 3：创建拖尾特效

1. 在 `Sword` 下创建子对象 `SlashTrail`
2. **Add Component** → `SlashTrail`
3. **Add Component** → `Line Renderer`
   - Material: 使用 `Sprites-Default` 或自定义发光材质
   - Width: 0.15 → 0.02（曲线渐变）
   - Color: 白色渐变到透明

### 步骤 4：配置 PlayerCombatSystem

在 `Player` 对象上找到 `PlayerCombatSystem` 组件：

| 字段 | 值 |
|------|-----|
| Sword Hitbox | 拖入 `Sword` 对象 |
| Enemy Layer Mask | 选择 `Enemy` Layer |
| Slash Trail | 拖入 `SlashTrail` 对象 |
| Swing Sounds | 添加挥砍音效（可多个） |
| Hit Sounds | 添加命中音效（可多个） |
| Combo Finisher Sound | 终结技专用音效 |

### 步骤 5：设置 Layer

确保敌人 GameObject 的 Layer 设为 `Enemy`。

---

## ⚙️ GameConfig 配置参数

在 `GameConfig` ScriptableObject 中，展开 **Combat** 部分：

```
Combat (战斗配置)
├── 剑参数
│   ├── Sword Length: 1.5      ← 剑的攻击距离
│   ├── Sword Width: 0.3       ← 剑的宽度
│   ├── Swing Duration: 0.15   ← 单次挥砍时间
│   └── Swing Angle: 150       ← 挥砍角度范围
│
├── 攻击参数
│   ├── Base Damage: 1         ← 基础伤害
│   ├── Attack Cooldown: 0.1   ← 连击窗口内的冷却
│   ├── Combo Reset Time: 0.5  ← 连击超时重置时间
│   └── Max Combo Count: 3     ← 最大连击数
│
└── 连击角度（可自定义每段攻击的轨迹）
    ├── Combo 1: 75° → -75°    (右斩)
    ├── Combo 2: -60° → 60°    (左斩)
    └── Combo 3: 0° → 180°     (横扫)
```

---

## 🎨 可选：剑的视觉 Sprite

如果想要剑有视觉效果，可以：

1. 创建一个 **白色剑形 Sprite**（32x128 像素左右）
2. 将其设置到 `Sword` 的 `Sprite Renderer`
3. `SwordHitbox` 会在挥砍时自动控制透明度

或者不使用 Sprite，只依赖 `SlashTrail` 的拖尾效果。

---

## 🧪 测试检查清单

- [ ] 按攻击键，剑会从右上向左下挥砍
- [ ] 连续快速攻击，第2击从左上向右下
- [ ] 第3击（终结技）有更大的挥砍范围
- [ ] 超过 0.5 秒不攻击，连击重置
- [ ] 剑命中敌人时造成伤害
- [ ] 同一次挥砍不会对同一敌人造成多次伤害
- [ ] 拖尾特效正确显示挥砍轨迹
- [ ] 不同连击段有不同音效（如果配置了）

---

## 🐛 常见问题

### Q: 剑不显示/不攻击？
检查：
1. `SwordHitbox` 是否正确挂载
2. `PlayerCombatSystem.SwordHitbox` 引用是否设置
3. 确保 `Polygon Collider 2D` 的 `Is Trigger` 已勾选

### Q: 攻击不命中敌人？
检查：
1. `Enemy Layer Mask` 是否包含敌人的 Layer
2. 敌人是否有 `Collider2D`
3. 敌人是否有 `EnemyController` 组件（用于接收伤害）

### Q: 连击不触发？
检查：
1. 攻击间隔是否在 `Combo Reset Time`（默认 0.5 秒）内
2. 控制台是否有 `[Combat]` 日志（勾选 `Log Combo Info` 可开启）

### Q: 拖尾特效不显示？
检查：
1. `Line Renderer` 是否存在
2. `Line Renderer.Material` 是否设置
3. `Sorting Layer` 是否正确（应在 Player 之上）
